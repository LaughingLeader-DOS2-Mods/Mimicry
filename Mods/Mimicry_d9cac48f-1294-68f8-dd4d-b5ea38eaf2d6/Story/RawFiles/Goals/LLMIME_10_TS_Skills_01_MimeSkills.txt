Version 1
SubGoalCombiner SGC_AND
INITSECTION

KBSECTION

//Fix for CharacterHeal sending vitality over the max
IF
CharacterVitalityChanged(_Target, _Percentage)
AND
ObjectGetFlag(_Target, "Mimicry_Wish_CheckHealthResult", 1)
AND
LeaderLib_Helper_QRY_ClearObjectFlag(_Target, "Mimicry_Wish_CheckHealthResult")
AND
_Percentage > 100
THEN
CharacterSetHitpointsPercentage(_Target, 100.0);

//REGION FINAL_WISH
IF
CharacterResurrected(_Target)
AND
DB_LLMIME_Skills_FinalWish_Target(_Target, _Caster)
THEN
NOT DB_LLMIME_Skills_FinalWish_Target(_Target, _Caster);
CharacterCharacterSetEvent(_Target, _Caster, "Mimicry_Events_RevivedByFinalWish");
LeaderLog_Log("DEBUG", "[Mimicry:Skills:CharacterResurrected] Final Wish target detected.");

//Remove [LLMIME_FINAL_WISH_BUFF] after a delay.
IF
CharacterReceivedDamage(_Character, _, _)
AND
HasActiveStatus(_Character, "LLMIME_FINAL_WISH_BUFF", 1)
THEN
SetStoryEvent(_Character, "Mimicry_Events_FinalWish_OnAttacked");
//END_REGION

//REGION DECOY
IF
ObjectTurnEnded((CHARACTERGUID)_Character)
AND
DB_LLMIME_Skills_Temp_Decoy(_Character, _Decoy)
THEN
CharacterCharacterSetEvent(_Character, _Decoy, "Mimicry_Events_Decoy_TauntNearbyEnemies");

/* Disabled for now - having to stay invisible for 2 turns to get the full use out of the decoy is a little much.
IF
CharacterStatusRemoved(_Character, "LLMIME_DECOY_ACTIVE", _)
AND
NOT LeaderLib_Helper_QRY_HasStatus(_Character, "LLMIME_DECOY_ACTIVE")
AND
DB_LLMIME_Skills_Temp_Decoy(_Character, _Decoy)
THEN
LLMIME_Skills_Internal_OnDecoyRemoved(_Decoy);
*/
//CharacterDieImmediate(_Decoy, 0, "None");

IF
CharacterPrecogDying(_Decoy)
AND
DB_LLMIME_Skills_Temp_Decoy(_Character, _Decoy)
THEN
LLMIME_Skills_Internal_OnDecoyRemoved(_Decoy);
/*
IF
StoryEvent((CHARACTERGUID)_Character, "Mimicry_Events_Skills_Internal_RemoveDecoyActiveStatus")
AND
NOT DB_LLMIME_Skills_Temp_Decoy(_Character, _)
AND
LeaderLib_Helper_QRY_HasStatus(_Character, "LLMIME_DECOY_ACTIVE")
THEN
SetStoryEvent(_Character, "Mimicry_Events_Decoy_RemoveInvisibility");

IF
CharacterStatusApplied(_Character, "HIT", _)
AND
DB_LLMIME_Skills_Temp_Decoy(_Character, _Decoy)
AND
LeaderLib_Helper_QRY_HasStatus(_Character, "LLMIME_DECOY_ACTIVE")
THEN
SetStoryEvent(_Character, "Mimicry_Events_Decoy_RemoveInvisibility");

IF
CharacterStatusApplied(_Character, _Status, _)
AND
DB_LLMIME_Skills_Temp_Decoy(_Character, _Decoy)
AND
LeaderLib_Helper_QRY_HasStatus(_Character, "LLMIME_DECOY_ACTIVE")
AND
LeaderLib_Helper_QRY_IsStunningStatus(_Status)
THEN
SetStoryEvent(_Character, "Mimicry_Events_Decoy_RemoveInvisibility");
*/
//END_REGION

//REGION MUGGABLE_FLAG

//DB_LLMIME_Skills_Temp_DisabledCharacter is checked when LLMIME_MUGGING is applied.
PROC
LeaderLib_StatusEvents_OnDisablingStatusApplied((CHARACTERGUID)_Character, (GUIDSTRING)_Cause, (STRING)_Status, (STRING)_Type)
THEN
DB_LLMIME_Skills_Temp_DisabledCharacter(_Character, _Status);
LeaderLog_Log("DEBUG", "[LLMIME:StatusEvents:OnDisablingStatusApplied] Disabling status [",_Status,"](",_Type,") was applied to character.");

IF
CharacterStatusRemoved(_Character, _Status, _)
AND
DB_LLMIME_Skills_Temp_DisabledCharacter(_Character, _Status)
THEN
NOT DB_LLMIME_Skills_Temp_DisabledCharacter(_Character, _Status);
//END_REGION

EXITSECTION

ENDEXITSECTION
ParentTargetEdge "LLMIME_10_ToggleScripts"